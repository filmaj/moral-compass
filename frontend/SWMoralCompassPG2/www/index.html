<!DOCTYPE html>
<html>
<!--
#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#  KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
-->
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name = "format-detection" content = "telephone=no"/>
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width;" />
        <link href="screen.css" media="screen" rel="stylesheet" type="text/css" />
        <title>Hello Cordova</title>
        <script type="text/javascript" src="cordova-2.0.0.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/jquery-1.7.2.js"></script>
        <script type="text/javascript" src="js/ScanditSDK.js"></script>
        <script type="text/javascript" src="js/moralcompass.js"></script>
        <script type="text/javascript" src="js/protovis.js"></script>
        
        <style type="text/css">
            
        </style>
    </head>
    <body>
        
        <header id="mc-topbar">
	       <h1>MoralCode</h1>
               <div id="mc-container-search" class="searchbar">
	       
	           <input type="search" placeholder="Enter a company name">
	           <input type="submit" value="Search">
	       
	       </div>
	</header>
        
        <!-- home -->
        <div id="mc-container-home" class="home">
	   
	   <div id="mc-content-home" class="content">
	       
	       <nav>
	           <ul>
	               <li>
                           <a href="#" id="mc-button-home-scan" class="button scan">
	                       Scan a Product
	                   </a>
	               </li> 
	               <li>
	                   <a href="#" id="mc-button-home-quiz" class="button quiz">
	                       Set your MoralCode
	                   </a>
	               </li>
	               <li>
	                   <a href="#" id="mc-button-home-search" class="button search">
	                       Search for a Company
	                   </a>
	               </li>
	           </ul>
	           
	       </nav>
	       
	   </div>
        </div>
        <!-- end home -->
        
        <!-- quiz -->
        <div id="mc-container-quiz" class="home">
	   <div id="mc-content-quiz" class="content">
	       
	       <div class="question">
	       
	           <h2>Same-sex marriage:</h2> 
	           <ul class="choice">
	               <li>
	                   <a href="#" class="button support">Support</a>
	               </li>
	               <li>
	                   <a href="#" class="button dontcare">Don't care</a>
	               </li>
	               <li>
	                   <a href="#" class="button oppose">Oppose</a>
	               </li>
	           </ul>
	       </div>
	   </div>
        </div>
        <!-- end quiz -->
        
        
        <div id="mc-container-summary" class="container">
            <div id="mc-barchart-back" class="mc-barchart"><div id="mc-barchart-front" class="mc-barchart"></div></div>
            
            <div id="mc-support-indicator"></div>
            <div id="mc-support-description"></div>
            <div id="mc-support-user-agree-text">You agree on <span id="mc-support-user-agree-text-percent"></span> 
                                                 of the same causes.</div>
            <div id="mc-support-other-indicator"></div>
            <div id="mc-support-others-agree-text"><span id="mc-support-others-agree-text-percent"></span> of users
                                                 agree with this company.</div>
            
        </div>
        <div id="mc-container-login" class="container">login!</div>
        <div id="mc-container-detail" class="container">detail!</div>
        <div id="mc-container-settings" class="container">settings!</div>
        
        
        <!-- replace with images! -->
        <footer id="mc-bottom-bar" class="bottomnav">
	       <nav>
	           <ul>
	               <li><a href="#" id="mc-link-home" class="button home">Home</a></li>
	               <li><a href="#" id="mc-link-search" class="button search">Search</a></li>
	               <li><a href="#" id="mc-link-scan" class="button scan">Scan</a></li>
	               <li><a href="#" id="mc-link-survey" class="button quiz">Quiz</a></li>
	               <li><a href="#" id="mc-link-account" class="button account">Account</a></li>
	           </ul>
	       </nav>
	   </footer>
        
        
        <script type="text/javascript">
            app.initialize();
            document.addEventListener("deviceready", onDeviceReady, false);
            
            // variable to hold the current stances on beliefs
            var myStances = new MCBeliefs();
            var isSearchOpen = false;
            
            /**
             *  Handle setup when the device is ready.
             */
            function onDeviceReady(){
                // load the currently saved results
                myStances.load();
            }
            
            //////////////////////////////////////////////
            // Controller
            //////////////////////////////////////////////
            var viewIds = ["mc-container-home",
                               "mc-container-quiz",
                               "mc-container-summary",
                               "mc-container-login",
                               "mc-container-detail",
                               "mc-container-settings",
                          ];
            
            /**
             *  Is a view Id valid?
             *  
             *  string -> boolean
             */
            function isViewIdValid(viewIdToTest){
                for(var i=0; i<viewIds.length; i++){
                    if(viewIds[i]==viewIdToTest) return true;
                }
                alert(viewIdToTest);
                return false;
            }
                           
            /**
             *  Switches to a view.
             *  
             *  TODO: program this properly and more efficiently!
             *  
             *  string -> void
             */
            function switchToView(viewIdToSwitchTo){
                //alert(viewIdToSwitchTo);
                if(!isViewIdValid(viewIdToSwitchTo)) return;
               
                // show relevent view
                $("#"+viewIdToSwitchTo).show();
                $("body").addClass(viewIdToSwitchTo);
                
                // hide all others
                for(var i=0; i<viewIds.length; i++){
                    if(viewIds[i]!=viewIdToSwitchTo){
                        $("#"+viewIds[i]).hide();
                        $("body").removeClass(viewIds[i]);
                    }
                }
                
            }
            
            /**
             *  Opens the search dialogue.
             *  
             *  Adds the search-open class to the body.
             *  
             *  void -> void
             */
            function searchOpen(){
                $("body").addClass("search-open");
                isSearchOpen = true;
            }
            
            /**
             *  Closes the search dialogue.
             *  
             *  Removes the search-open class from the body.
             *  
             *  void -> void
             */
            function searchClose(){
                $("body").removeClass("search-open");
                isSearchOpen = false;
            }
            
            /**
             *  Toggles the search dialogue.
             *  
             *  void -> void
             */
            function toggleSearch(){
                if(isSearchOpen){
                    searchClose();
                }else{
                    searchOpen();
                }
            }

            // home search scan survey setting
            
            // JQuery rigging

            
            
            $("#mc-link-home").click(function(){
                switchToView("mc-container-home");
            });
            
            $("#mc-link-search").click(function(){
                toggleSearch();
            });
            
            $("#mc-link-scan").click(function() {
                MCApp.scanBarcode();
            });
            
            $("#mc-link-survey").click(function(){
                switchToView("mc-container-quiz");
            });
            
            $("#mc-link-account").click(function(){
                switchToView("mc-container-settings");
            });
            
            $("#mc-button-home-scan").click(function(){
                MCApp.scanBarcode();
            });
            
            $("#mc-button-home-quiz").click(function(){
                switchToView("mc-container-quiz");
            })
            
            $("#mc-button-home-search").click(function(){
                toggleSearch();
            })
            
            
            // summary view controller
            var summaryView = new MCSummaryViewController();
            
            MCApp.handleUpdateAfterCompany = function(){
                summaryView.setCompanyName(MCApp.getCurrentCompanyName());
                var barcode = MCApp.getCurrentBarcode();
                var testGen = new MCTest();
                var testVector = testGen.getTestStancesFromBarcode(barcode);
                var numAgree = myStances.getNumAgreeToArrayOfCompanyStances(testVector);
                summaryView.setPercentAgree(numAgree/9);
                summaryView.setPercentUsersAgree(50);
                switchToView("mc-container-summary");
                alert("handle scan");
            }
            
            
           switchToView("mc-container-home");
            
        </script>
    </body>
</html>
